<div class="card">
  <div class="card-header">
    <h2>Recuperar Contraseña</h2>
  </div>
  <div class="card-body">
    <div *ngIf="!codeSent">
      <form #emailForm="ngForm" (ngSubmit)="sendCode()">
        <div class="form-group">
          <label for="email">Correo Electrónico:</label>
          <input type="email" id="email" [(ngModel)]="email" name="email" class="form-control" required email pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.(com|cl|net|org)$">
          <div *ngIf="emailForm.controls['email']?.invalid && emailForm.controls['email']?.touched" class="error-message">
            <small *ngIf="emailForm.controls['email']?.errors?.['required']">El correo es requerido.</small>
            <small *ngIf="emailForm.controls['email']?.errors?.['email']">Formato de correo inválido.</small>
            <small *ngIf="emailForm.controls['email']?.errors?.['pattern']">El correo debe ser .com, .cl, .net, o .org.</small>
          </div>
        </div>
        <button type="submit" class="btn btn-primary" [disabled]="!emailForm.valid">Enviar</button>
      </form>
    </div>

    <div *ngIf="codeSent && !codeVerified">
      <form #codeForm="ngForm" (ngSubmit)="verifyCode()">
        <div class="form-group">
          <label for="code">Código de Verificación:</label>
          <div class="code-inputs">
            <input type="text" maxlength="1" [(ngModel)]="code[0]" name="code0" class="form-control" required>
            <input type="text" maxlength="1" [(ngModel)]="code[1]" name="code1" class="form-control" required>
            <input type="text" maxlength="1" [(ngModel)]="code[2]" name="code2" class="form-control" required>
            <input type="text" maxlength="1" [(ngModel)]="code[3]" name="code3" class="form-control" required>
            <input type="text" maxlength="1" [(ngModel)]="code[4]" name="code4" class="form-control" required>
            <input type="text" maxlength="1" [(ngModel)]="code[5]" name="code5" class="form-control" required>
          </div>
          <button type="submit" class="btn btn-primary" [disabled]="!codeForm.valid">Verificar Código</button>
        </div>
      </form>
    </div>

    <div *ngIf="codeVerified">
      <form #passwordForm="ngForm" (ngSubmit)="updatePassword()">
        <div class="form-group">
          <label for="newPassword">Nueva Contraseña:</label>
          <input type="password" id="newPassword" [(ngModel)]="newPassword" name="newPassword" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary" [disabled]="!passwordForm.valid">Actualizar Contraseña</button>
      </form>
    </div>
  </div>
</div>
